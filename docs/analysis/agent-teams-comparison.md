# Agent Teamsとorchestrator-ccの比較分析

## 概要

本ドキュメントは、Claude CodeのAgent Teams機能とorchestrator-ccプロジェクトの比較分析を行い、両者の機能差分、置換可能性、将来の移行方針について検討した結果をまとめたものです。

**作成日**: 2026-02-06
**対象バージョン**:
- orchestrator-cc: Phase 0-4完了
- Agent Teams: Claude Codeネイティブ機能

---

## 1. 両者の技術概要

### 1.1 orchestrator-ccのアーキテクチャ

orchestrator-ccは、**tmuxセッション内で複数のClaude Codeプロセスを起動・管理**するシステムです。

```
tmuxセッション (orchestratorcc)
├── ペイン0: Grand Boss      (claude --system-prompt "...")
├── ペイン1: Middle Manager  (claude --system-prompt "...")
└── ペイン2: Coding Specialist (claude --system-prompt "...")
```

**技術スタック**:
- プロセス管理: tmux + Python
- 通信方式: YAMLファイルポーリング + 合言葉検出
- 監視: FastAPI + WebSocket
- 設定: YAML + テキストファイル

### 1.2 Agent Teamsのアーキテクチャ

Agent Teamsは、Claude Codeに組み込まれた**ネイティブのマルチエージェント管理機能**です。

```
チーム (team-name)
├── config.json       # チーム設定・メンバー情報
├── tasks/            # タスク管理ディレクトリ
└── インボックス      # 自動メッセージ配信
```

**技術スタック**:
- プロセス管理: Claude Codeネイティブ（tmuxバックエンド使用）
- 通信方式: SendMessageツール（インボックス）
- タスク管理: Taskツール（依存関係・所有権管理）
- プロトコル: シャットダウン・計画承認

---

## 2. 機能比較

### 2.1 通信方式

| 項目 | orchestrator-cc | Agent Teams |
|------|-----------------|-------------|
| **メカニズム** | YAMLファイル書き込み + ポーリング | SendMessageツール + インボックス |
| **送信方法** | 手動でファイルパスを指定 | `SendMessage`ツールで自動配信 |
| **応答検出** | 合言葉（マーカー）文字列の検出 | インボックス確認 |
| **待機方式** | 0.5秒間隔ポーリング | イベント駆動（非同期） |
| **配信保証** | なし（ファイル書き込み失敗の可能性あり） | 自動リトライ・エラーハンドリング |

**差分の分析**:
- orchestrator-ccは能動的なポーリングを行うため、CPU使用率と待機時間のトレードオフがある
- Agent Teamsはイベント駆動で効率的だが、SendMessageツールの使用が必須

### 2.2 タスク管理

| 項目 | orchestrator-cc | Agent Teams |
|------|-----------------|-------------|
| **実装方式** | Middle Managerが個別に管理 | Taskツールで標準化 |
| **依存関係** | 暗黙的（Middle Managerの判断） | 明示的（blocks/blockedBy属性） |
| **所有権** | なし | owner属性でエージェント割り当て |
| **状態遷移** | なし | pending→in_progress→completed |
| **自己調整** | なし | 自動アンブロック機能 |

**差分の分析**:
- Agent Teamsは標準化されたタスク管理を持つため、複雑な依存関係を扱う場合に有利
- orchestrator-ccはMiddle Managerの判断に委ねるため、柔軟性が高いが再現性は低い

### 2.3 チームライフサイクル

| 項目 | orchestrator-cc | Agent Teams |
|------|-----------------|-------------|
| **作成方法** | YAML設定で静的に定義 | `Teammate`ツールで動的に作成 |
| **終了方法** | セッション全体をkill | `requestShutdown`プロトコルで整理終了 |
| **状態保存** | なし | config.json + inboxで永続化 |
| **再開** | なし | セッション再開が可能（予定） |

**差分の分析**:
- Agent Teamsはグレースフルシャットダウンプロトコルを持つ
- orchestrator-ccはプロセスを強制終了するため、途中状態が失われる可能性がある

### 2.4 その他の機能

| 機能 | orchestrator-cc | Agent Teams |
|------|-----------------|-------------|
| **Webダッシュボード** | ✅ 実装済み | ❌ なし |
| **カスタム性格プロンプト** | ✅ テキストファイル | ✅ 設定可能 |
| **計画承認ワークフロー** | ❌ なし | ✅ ExitPlanMode連携 |
| **メッセージログ** | ✅ 実装済み | ✅ インボックス |
| **監視メトリクス** | ✅ リアルタイム | ❌ なし |

---

## 3. orchestrator-cc独自の機能価値

### 3.1 Webダッシュボード

**実装内容**:
- FastAPI + WebSocketによるリアルタイム監視
- 各エージェントの思考ログを表示
- クラスタ状態の可視化

**独自価値**:
- 視覚的な監視インターフェース
- デバッグ・分析に有用
- Agent Teamsには同等の機能がない

### 3.2 合言葉検出方式

**実装内容**:
- 特定のマーカー文字列（`CODING OK`等）で応答完了を判定
- 柔軟なパターンマッチング

**独自価値**:
- ユーザー定義のマーカーで応答を検出可能
- インボックス方式とは異なる判定ロジック

### 3.3 YAMLプロトコル

**実装内容**:
- YAMLファイルを介した通信プロトコル
- メッセージ構造の明示的な定義

**独自価値**:
- 通信内容の可視性が高い
- デバッグ時にファイルを直接確認可能

---

## 4. 置換可能性の分析

### 4.1 完全に置換可能な部分

| コンポーネント | 置換可否 | 理由 |
|---------------|---------|------|
| **tmuxプロセス管理** | ✅ 可能 | Agent Teamsがtmuxバックエンドを使用 |
| **エージェント間通信** | ✅ 可能 | SendMessageが同等の機能を提供 |
| **カスタム性格プロンプト** | ✅ 可能 | Agent Teamsでも設定可能 |

### 4.2 置換できない部分（独自価値）

| コンポーネント | 置換可否 | 理由 |
|---------------|---------|------|
| **Webダッシュボード** | ❌ 不可 | Agent Teamsには監視UIがない |
| **合言葉検出** | ❌ 不可 | インボックス方式とは異なる判定ロジック |
| **YAMLプロトコル** | ⚠️ 部分的 | SendMessageツールが標準プロトコル |

---

## 5. 推奨されるアプローチ

### 5.1 基本機能はAgent Teamsに移行

以下の機能はAgent Teamsの標準機能に置換可能です：

1. **プロセス管理** - `Teammate`ツールで動的にチーム作成
2. **エージェント間通信** - `SendMessage`ツールに置換
3. **タスク管理** - `Task`ツールの標準機能を使用

### 5.2 独自価値は維持

以下の機能はorchestrator-ccの独自価値として維持します：

1. **Webダッシュボード** - Agent Teams上に拡張として実装
2. **合言葉検出** - オプション機能として提供

### 5.3 ハイブリッド構成

理想的な構成は以下の通りです：

```
┌─────────────────────────────────────────────────────────┐
│                 orchestrator-cc (拡張レイヤー)           │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ Webダッシュボード（Agent Teamsの状態を可視化）   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│              Agent Teams (基盤レイヤー)                  │
│                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │SendMessage  │  │Task管理     │  │Teammate     │     │
│  │ツール       │  │ツール       │  │ツール       │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 6. 移行計画（オプション）

将来的にAgent Teamsへの移行を検討する場合、以下のフェーズで進めることを推奨します：

### Phase A: 基盤移行
- プロセス管理を`Teammate`ツールに置換
- 通信を`SendMessage`ツールに移行

### Phase B: タスク管理移行
- タスク管理を`Task`ツールに移行
- 依存関係を明示的に定義

### Phase C: 拡張機能の実装
- WebダッシュボードをAgent Teams上に再実装
- 合言葉検出をオプション機能として追加

---

## 7. 結論

1. **機能的に重複する部分が多い**: プロセス管理、エージェント間通信などはAgent Teamsで実現可能

2. **独自価値は維持する価値がある**: Webダッシュボード、合言葉検出はorchestrator-cc独自の強み

3. **ハイブリッド構成が現実的**: Agent Teamsを基盤にしつつ、独自機能を拡張として追加

4. **移行は慎重に検討を**: 現状のorchestrator-ccは動作しており、無理に移行する必要はない

---

## 関連ドキュメント

- [overview.md](../overview.md) - orchestrator-ccの全体概要
- [architecture.md](../architecture.md) - アーキテクチャ詳細
- [validation.md](../validation.md) - 検証結果の記録
