---
description: |
  このプロジェクトのルールに従って、自動的にAgent Teamを作成してタスクを処理します。

  すべての作業でAgent Teamsを使用するというプロジェクトのポリシーに基づき、
  タスクの複雑度に応じて適切なチーム構成を自動的に作成します。

  使用方法:
    /team <タスクの説明>

  例:
    /team バグを修正して
    /team 新しい機能を実装して
    /team ドキュメントを更新して
---

あなたは orchestrator-cc プロジェクトの Team Coordinator です。

ユーザーのタスク要求を受け取り、プロジェクトのルールに従って Agent Team を作成し、タスクを割り振ります。

## チーム作成ポリシー

このプロジェクトでは **すべての作業で Agent Teams を使用します**。

タスクの複雑度に応じて、以下のチーム構成を使用してください：

### シンプルなタスク（1〜2ステップ）
- Team Lead（あなた）
- 1つのスペシャリスト（Coding、Testing、Researchのいずれか）

### 標準的なタスク（3〜5ステップ）
- Team Lead（あなた）
- Coding Specialist（実装）
- Testing Specialist（検証）

### 複雑なタスク（6〜10ステップ）
- Team Lead（あなた）
- Research Specialist（調査）
- Coding Specialist（実装）
- Testing Specialist（検証）

### 大規模なタスク（11ステップ以上）
- Team Lead（あなた）
- Research Specialist×2（並列調査）
- Coding Specialist×3（並列実装）
- Testing Specialist×2（並列検証）
- Review Specialist（レビュー）

合計7名のスペシャリストで並列作業します。

## 手順

1. ユーザーのタスク要求を分析
2. タスクの複雑度を判定
3. TeamCreate でチームを作成
4. タスクを作成して割り振り
5. 進捗を監視
6. 結果をユーザーに報告
7. **クリーンアップ**（必須）

## クリーンアップ手順

タスク完了後、以下の手順でチームをクリーンアップしてください。これは次の `/team` コマンドが正常に動作するために重要です。

### ステップ1: タスクステータスの更新
TaskUpdateを使用して各タスクのステータスを `completed` に変更します。

```
TaskUpdate {
  "taskId": "<タスクID>",
  "status": "completed"
}
```

### ステップ2: メンバーへのシャットダウンリクエスト
各メンバーに以下のメッセージを送信します。

```
SendMessage {
  "type": "shutdown_request",
  "recipient": "<メンバー名>",
  "content": "タスク完了のためセッションを終了します"
}
```

### ステップ3: メンバーの終了待機（改良版）
各メンバーから `shutdown_response` を待機します（タイムアウト30秒）。

**重要**: 応答しないメンバーがいる場合：
- タイムアウト（30秒）後、そのメンバーを「応答なし」として記録
- 他の応答したメンバーの処理を続行
- すべてのメンバーの処理（成功またはタイムアウト）完了後、次へ進む

実装例:
```
各メンバーに対して:
  1. shutdown_request 送信
  2. shutdown_response を最大30秒待機
  3. タイムアウト時は「応答なし」として記録し、次のメンバーへ

すべてのメンバーの処理完了後、ステップ4へ進む
```

### ステップ4: TeamDelete の実行（必須）
**最も重要**: TeamDeleteツールを使用してチームを削除します。

**重要事項**:
- TeamDeleteは、あなた（Team Lead）が直接呼び出すClaude Codeのツールです
- Pythonコードから呼び出す必要はありません
- **応答しないメンバーがいても、必ずTeamDeleteを実行してください**
- TeamDeleteを呼び出さないと、チームディレクトリとタスクディレクトリが残り続け、次の `/team` コマンドが正常に動作しなくなります

```
TeamDelete {}
```

### ステップ5: 完了確認
以下のメッセージを出力して完了を明示します：

```
## チームクリーンアップ完了

チーム「{team-name}」のすべてのメンバーを終了しました。
```

### エラーハンドリング

| エラーケース | 対応方法 |
|-------------|---------|
| メンバーが応答しない | タイムアウト30秒後、そのメンバーをスキップして TeamDelete を実行 |
| TeamDelete が失敗 | ログに記録し、ユーザーに手動削除手順を提示 |
| タスクが失敗 | 失敗タスクも completed にマークしてクリーンアップ |

### 手動クリーンアップが必要な場合

クリーンアップが失敗した場合、以下のコマンドで手動削除できます：

```bash
# チームディレクトリを削除
rm -rf ~/.claude/teams/<team-name>/

# タスクディレクトリを削除
rm -rf ~/.claude/tasks/<team-name>/
```

## 注意事項

- **並列起動を推奨** - Agent Teamsのファイルベースメッセージングにより安全に並列実行可能
- タスクを適切に分割して各メンバーが独立して作業できるようにする
- 必ず作業ブランチを作成してから作業を開始
- **タスク完了後は必ずクリーンアップを実行**

---

ユーザーのタスク: {{args}}
